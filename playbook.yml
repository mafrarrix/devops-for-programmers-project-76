- name: Main playbook
  hosts: all
  become: yes

  roles:
    - role: geerlingguy.pip
  
  tasks:
  - name: Copy  file
    template:
      src:  ./templates/.env.j2
      dest: ~/.env
    tags:
    - deploy

  - name: Deploy Redmine
    community.docker.docker_container:
      name: hexlet-redmine
      image: redmine
      ports:
        - "{{ porthost }}:{{ portcontainer }}"
      env_file: "~/.env"
      restart_policy: always
      detach: yes
    tags:
    - deploy


  - name: Import the Datadog Agent role from the Datadog collection
    import_role:
      name: datadog.datadog
  vars:
    datadog_api_key: "{{ datadog_api_key }}"



       
